<!DOCTYPE html>
<html>
<head>
    <title>SkillSwap - Matches</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .nav { background: #f4f4f4; padding: 10px; margin-bottom: 20px; }
        .nav a { margin-right: 15px; text-decoration: none; color: #333; }
        .match-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .match-teach { border-left: 4px solid #28a745; }
        .match-learn { border-left: 4px solid #007bff; }
        .btn { background: #6c757d; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="nav">
        <a href="/">Home</a>
        <a href="/profile-page?email={{ email }}">My Profile</a>
        <a href="/matches-page?email={{ email }}">My Matches</a>
        <a href="/login-page" style="float: right;">Logout</a>
    </div>

    <h2>My Skill Matches</h2>
    <p>Find people to learn from and teach!</p>

    <div id="matches-container">
        <em>Loading matches...</em>
    </div>

    <script>
        const email = "{{ email }}";
        
        // FIXED ENDPOINT
        fetch(`/users/${email}/matches`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load matches');
                }
                return response.json();
            })
            .then(data => {
                console.log('Matches data:', data); // Debug log
                const container = document.getElementById('matches-container');
                
                if (data.matches_found === 0) {
                    container.innerHTML = '<p>No matches found yet. Add more skills to your profile!</p>';
                    return;
                }

                let html = `<p>Found ${data.matches_found} potential matches:</p>`;
                
                data.matches.forEach(match => {
                    if (match.match_type === 'you_can_teach') {
                        html += `
                            <div class="match-card match-teach">
                                <h4>ðŸŽ¯ You can teach: ${match.your_skill}</h4>
                                <p><strong>Student:</strong> ${match.matched_user.name} (${match.matched_user.email})</p>
                                <p><strong>They want:</strong> ${match.their_request}</p>
                                <button class="btn">Contact to Teach</button>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="match-card match-learn">
                                <h4>ðŸ“š You can learn: ${match.skill_you_need}</h4>
                                <p><strong>Teacher:</strong> ${match.matched_user.name} (${match.matched_user.email})</p>
                                <p><strong>They offer:</strong> ${match.their_offer}</p>
                                <p><strong>Skill level:</strong> ${match.their_skill_level}</p>
                                <button class="btn">Contact to Learn</button>
                            </div>
                        `;
                    }
                });
                
                container.innerHTML = html;
            })
            .catch(error => {
                console.error('Error loading matches:', error);
                document.getElementById('matches-container').innerHTML = '<em>Error loading matches: ' + error.message + '</em>';
            });
    </script>
</body>
</html>